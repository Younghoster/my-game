{"version":3,"sources":["Game.js"],"names":["Global","require","cc","Class","extends","Component","properties","wrap","default","type","Node","ball","coverStart","map","orc","Prefab","storehouse","bomb","board","blood","coverOver","audioBgm","AudioClip","audioFail","pauseBtn","stateSwitch","pauseGame","director","resume","loader","loadRes","SpriteFrame","err","res","getComponent","Sprite","spriteFrame","pause","playAgain","gameInfo","score","reviveScore","total","level","orcBoom","orcBoard","orcMoney","loadScene","startGame","destroy","countToatal","seq","sequence","moveTo","width","callFunc","state","schedule","creatStorehouse","creatBomb","creatBoard","runAction","gameOver","active","audioEngine","stopMusic","play","creatBloodPool","bloodPool","NodePool","i","instantiate","put","explode","node","_x","x","_y","y","height","size","get","log","setPosition","parent","ParticleSystem","resetSystem","scheduleOnce","creatOrcPool","orcPool","creatOrc","console","onLoad","game","managerCollis","getCollisionManager","enabled","balljs","playMusic","start","on","value","bounce","Math","abs"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Game","sourcesContent":["const Global = require('Global');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 整体容器（缩放用）\r\n        wrap: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        ball: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 开始遮罩\r\n        coverStart: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 地图容器\r\n        map: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 兽人\r\n        orc: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 宝箱\r\n        storehouse: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 炸弹\r\n        bomb: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 木板\r\n        board: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 血液粒子\r\n        blood: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 开始遮罩\r\n        coverOver: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // bgm\r\n        audioBgm: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        audioFail: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        pauseBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n    },\r\n    // 暂停\r\n    stateSwitch() {\r\n        if (this.pauseGame) {\r\n            this.pauseGame = false;\r\n            cc.director.resume();\r\n            cc.loader.loadRes('pause', cc.SpriteFrame, (err, res) => {\r\n                this.pauseBtn.getComponent(cc.Sprite).spriteFrame = res;\r\n            });\r\n        } else {\r\n            this.pauseGame = true;\r\n            cc.director.pause();\r\n            cc.loader.loadRes('play', cc.SpriteFrame, (err, res) => {\r\n                this.pauseBtn.getComponent(cc.Sprite).spriteFrame = res;\r\n            });\r\n        }\r\n    },\r\n    // 再来一次\r\n    playAgain() {\r\n        // 重置参数\r\n        Global.gameInfo.score = 0;\r\n        Global.gameInfo.reviveScore = 0;\r\n        Global.gameInfo.total = 20;\r\n        Global.gameInfo.level = 0;\r\n        Global.gameInfo.orcBoom = 6;\r\n        Global.gameInfo.orcBoard = 5;\r\n        Global.gameInfo.orcMoney = 10;\r\n        // 重新加载场景\r\n        cc.director.loadScene('Game');\r\n    },\r\n    // 开始\r\n    startGame() {\r\n        this.coverStart.destroy();\r\n        Global.gameInfo.countToatal = Global.gameInfo.total;\r\n        let seq = cc.sequence(cc.moveTo(1, this.wrap.width / 2, 500), cc.callFunc(() => {\r\n            Global.gameInfo.state = 'running';\r\n            // 金币箱兽人生成\r\n            this.schedule(() => this.creatStorehouse(), Global.gameInfo.orcMoney);\r\n            // 炸弹箱子兽人生成\r\n            this.schedule(() => this.creatBomb(), Global.gameInfo.orcBoom);\r\n            // 木板兽人生成\r\n            this.schedule(() => this.creatBoard(), Global.gameInfo.orcBoard);\r\n        }));\r\n        // seq.easing(cc.easeOut(3));\r\n        this.ball.runAction(seq);\r\n    },\r\n    // 游戏结束\r\n    gameOver() {\r\n        this.coverOver.active = true;\r\n        cc.audioEngine.stopMusic();\r\n        cc.audioEngine.play(this.audioFail, false);\r\n    },\r\n    // 血液粒子对象池\r\n    creatBloodPool() {\r\n        this.bloodPool = new cc.NodePool();\r\n        for (let i = 0; i < Global.gameInfo.total - 5; ++i) {\r\n            let blood = cc.instantiate(this.blood);\r\n            this.bloodPool.put(blood);\r\n        }\r\n    },\r\n    // 血浆粒子爆炸\r\n    explode(node) {\r\n        let blood = null,\r\n            _x = node.x + node.width / 2, \r\n            _y = node.y + node.height / 2;\r\n        if (this.bloodPool.size() > 0) {\r\n            blood = this.bloodPool.get();\r\n        } else {\r\n            cc.log('重新创建粒子');\r\n            blood = cc.instantiate(this.blood);\r\n        }\r\n        blood.setPosition(_x, _y);\r\n        blood.parent = this.map;\r\n        blood.getComponent(cc.ParticleSystem).resetSystem();\r\n        \r\n        // 0.2秒后回收\r\n        this.scheduleOnce(() => this.bloodPool.put(blood), 0.5);\r\n    },\r\n    // 兽人对象池\r\n    creatOrcPool() {\r\n        this.orcPool = new cc.NodePool();\r\n        for (let i = 0; i < Global.gameInfo.total; ++i) {\r\n            let orc = cc.instantiate(this.orc);\r\n            this.orcPool.put(orc);\r\n        }\r\n    },\r\n    // 制造兽人\r\n    creatOrc() {\r\n        let orc = null;\r\n        if (this.orcPool.size() > 0) { \r\n            orc = this.orcPool.get();\r\n        } else { \r\n            console.log('对象池不够用，重新创建');\r\n            orc = cc.instantiate(this.orc);\r\n        }\r\n        orc.y = 0;\r\n        orc.x = -orc.width;\r\n        orc.parent = this.map;\r\n        // orc.getComponent('Orc').init(); \r\n    },\r\n    // 制造宝箱\r\n    creatStorehouse() {\r\n        let orc = cc.instantiate(this.storehouse);\r\n        orc.y = 0;\r\n        orc.x = -orc.width;\r\n        orc.parent = this.map;\r\n    },\r\n    // 制造炸弹\r\n    creatBomb() {\r\n        let orc = cc.instantiate(this.bomb);\r\n        orc.y = 0;\r\n        orc.x = -orc.width;\r\n        orc.parent = this.map;\r\n    },\r\n    // 制造木板\r\n    creatBoard() {\r\n        let orc = cc.instantiate(this.board);\r\n        orc.y = 0;\r\n        orc.x = -orc.width;\r\n        orc.parent = this.map;\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        Global.game = this;\r\n        //碰撞系统\r\n        const managerCollis = cc.director.getCollisionManager();\r\n        managerCollis.enabled = true;\r\n        // 开启碰撞系统的调试线框绘制\r\n        // managerCollis.enabledDebugDraw = true;\r\n        // managerCollis.enabledDrawBoundingBox = true;\r\n\r\n        // ball 脚本\r\n        this.balljs = this.ball.getComponent('Ball');\r\n\r\n        // 使用兽人对象池\r\n        this.creatOrcPool();\r\n        // 产出兽人\r\n        for (let i = 0; i < Global.gameInfo.total; i++) this.creatOrc();\r\n        // 使用粒子对象池\r\n        this.creatBloodPool();\r\n\r\n        cc.audioEngine.playMusic(this.audioBgm, true);\r\n    },\r\n\r\n    start() {\r\n        this.node.on('touchstart', () => {\r\n            if (Global.gameInfo.state == 'over' || this.pauseGame) return;\r\n            \r\n            this.balljs.value = 3;\r\n            // this.balljs.bg_speed *= 2;\r\n            // if (this.balljs.bounce > 0) \r\n            this.balljs.bounce = -Math.abs(this.balljs.bounce);\r\n\r\n        }, this);\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}