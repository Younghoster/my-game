{"version":3,"sources":["player.js"],"names":["Global","require","cc","Class","extends","Component","properties","bulletPrefab","default","type","Prefab","count","onCollisionEnter","other","self","that","resetFn","text","node","name","parent","removeChild","scheduleOnce","gameData","pack","console","log","game","gameEnd","bulletObjGroup","bulletPool","NodePool","i","bullet","instantiate","put","createBullet","parentNode","key","_x","getPosition","x","_y","y","height","size","get","setPosition","datakey","shooting","over","parseInt","bulletNum","onLoad","start","update","dt"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\game","sourcesContent":["const Global = require(\"Global\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 子弹资源\r\n        bulletPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        count: 0\r\n    },\r\n\r\n    // 碰撞检测\r\n    onCollisionEnter(other, self) {\r\n        let that = this;\r\n        // 清除撞到的道具\r\n        function resetFn(text) {\r\n            if (other.node.name == text) other.node.parent.removeChild(other.node);\r\n            that.scheduleOnce(() => Global.gameData.pack = '', 5);\r\n        }\r\n        console.log('飞机撞到的物体：', other.node.name);\r\n        if (other.node.name == 'prop') {\r\n            Global.gameData.pack = 'three';\r\n            resetFn('prop');\r\n        } else if (other.node.name == 'forceful') {\r\n            Global.gameData.pack = 'forceful';\r\n            resetFn('forceful');\r\n        } else {\r\n            Global.game.gameEnd();\r\n        }\r\n    },\r\n    // 子弹对象池\r\n    bulletObjGroup() {\r\n        // 储存到 Global 里面\r\n        Global.gameData.bulletPool = new cc.NodePool();\r\n        for (let i = 0; i < 50; ++i) {\r\n            // 创建节点\r\n            let bullet = cc.instantiate(this.bulletPrefab);\r\n            // 通过 putInPool 接口放入对象池\r\n            Global.gameData.bulletPool.put(bullet);\r\n        }\r\n    },\r\n    /** \r\n     * 创建子弹\r\n     * key: 2 为直线射击 1 & 3 则左右两边倾斜射击\r\n    */\r\n    createBullet(parentNode, key = 2) {\r\n        let bullet = null,\r\n            _x = this.node.getPosition().x,\r\n            _y = this.node.getPosition().y + this.node.height / 4;\r\n        // 通过 size 接口判断对象池中是否有空闲的对象\r\n        if (Global.gameData.bulletPool.size() > 0) {\r\n            bullet = Global.gameData.bulletPool.get();\r\n        } else {\r\n            // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\r\n            bullet = cc.instantiate(this.bulletPrefab);\r\n        }\r\n        bullet.setPosition(_x, _y);\r\n        // 将生成的敌人加入节点树\r\n        bullet.parent = parentNode;\r\n        // 设置key标记\r\n        bullet.datakey = key\r\n        // cc.log(bullet.datakey)\r\n    },\r\n    shooting() {\r\n        if (Global.gameData.over) return;\r\n        this.count += 1;\r\n        if (this.count % parseInt(60 / Global.gameData.bulletNum) === 0) {\r\n            // 检查获取道具包\r\n            if (Global.gameData.pack === 'three') {\r\n                for (let i = 1; i <= 3; i++) {\r\n                    this.createBullet(Global.game.node, i);\r\n                }\r\n            } else {\r\n                this.createBullet(Global.game.node);\r\n            }\r\n        }\r\n        if (this.count >= 600) this.count = 0;\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        // 创建子弹对象池\r\n        this.bulletObjGroup();\r\n    },\r\n\r\n    start () {\r\n        // this.getComponent('player')\r\n    },\r\n\r\n    update (dt) {\r\n        this.shooting()\r\n    },\r\n});\r\n"]}