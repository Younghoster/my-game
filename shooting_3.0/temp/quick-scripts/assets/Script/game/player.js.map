{"version":3,"sources":["player.js"],"names":["Global","require","cc","Class","extends","Component","properties","bulletPrefab","default","type","Prefab","count","onCollisionEnter","other","self","that","resetFn","text","node","name","parent","removeChild","scheduleOnce","gameData","pack","bulletNum","console","log","game","gameEnd","bulletObjGroup","bulletPool","NodePool","i","bullet","instantiate","put","createBullet","parentNode","key","_x","getPosition","x","_y","y","height","size","get","setPosition","datakey","shooting","over","parseInt","onLoad","start","update","dt"],"mappings":"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","file":"player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\game","sourcesContent":["const Global = require(\"Global\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 子弹资源\r\n        bulletPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        count: 0\r\n    },\r\n\r\n    // 碰撞检测\r\n    onCollisionEnter(other, self) {\r\n        const that = this;\r\n        // 清除撞到的道具\r\n        function resetFn(text) {\r\n            if (other.node.name == text) other.node.parent.removeChild(other.node);\r\n            that.scheduleOnce(() => {\r\n                Global.gameData.pack = '';\r\n                if (text == 'fast') Global.gameData.bulletNum = Global.gameData.bulletNum / 2;\r\n            }, 5);\r\n        }\r\n        console.log('飞机撞到的物体：', other.node.name);\r\n        if (other.node.name == 'prop') {\r\n            Global.gameData.pack = 'three';\r\n            resetFn('prop');\r\n        } else if (other.node.name == 'forceful') {\r\n            Global.gameData.pack = 'forceful';\r\n            resetFn('forceful');\r\n        } else if (other.node.name == 'fast') {\r\n            Global.gameData.pack = 'fast';\r\n            Global.gameData.bulletNum = Global.gameData.bulletNum * 2;\r\n            resetFn('fast');\r\n        } else {\r\n            Global.game.gameEnd();\r\n        }\r\n    },\r\n    // 子弹对象池\r\n    bulletObjGroup() {\r\n        // 储存到 Global 里面\r\n        Global.gameData.bulletPool = new cc.NodePool();\r\n        for (let i = 0; i < 50; ++i) {\r\n            // 创建节点\r\n            let bullet = cc.instantiate(this.bulletPrefab);\r\n            // 通过 putInPool 接口放入对象池\r\n            Global.gameData.bulletPool.put(bullet);\r\n        }\r\n    },\r\n    /** \r\n     * 创建子弹\r\n     * key: 2 为直线射击 1 & 3 则左右两边倾斜射击\r\n    */\r\n    createBullet(parentNode, key = 2) {\r\n        let bullet = null,\r\n            _x = this.node.getPosition().x,\r\n            _y = this.node.getPosition().y + this.node.height / 4;\r\n        // 通过 size 接口判断对象池中是否有空闲的对象\r\n        if (Global.gameData.bulletPool.size() > 0) {\r\n            bullet = Global.gameData.bulletPool.get();\r\n        } else {\r\n            // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\r\n            bullet = cc.instantiate(this.bulletPrefab);\r\n        }\r\n        bullet.setPosition(_x, _y);\r\n        // 将生成的敌人加入节点树\r\n        bullet.parent = parentNode;\r\n        // 设置key标记\r\n        bullet.datakey = key\r\n        // cc.log(bullet.datakey)\r\n    },\r\n    shooting() {\r\n        if (Global.gameData.over) return;\r\n        this.count += 1;\r\n        if (this.count % parseInt(60 / Global.gameData.bulletNum) === 0) {\r\n            // 检查获取道具包\r\n            if (Global.gameData.pack === 'three') {\r\n                for (let i = 1; i <= 3; i++) {\r\n                    this.createBullet(Global.game.node, i);\r\n                }\r\n            } else {\r\n                this.createBullet(Global.game.node);\r\n            }\r\n        }\r\n        if (this.count >= 600) this.count = 0;\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        // 创建子弹对象池\r\n        this.bulletObjGroup();\r\n    },\r\n\r\n    start () {\r\n        // this.getComponent('player')\r\n    },\r\n\r\n    update (dt) {\r\n        this.shooting()\r\n    },\r\n});\r\n"]}