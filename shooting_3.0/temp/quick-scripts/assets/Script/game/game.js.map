{"version":3,"sources":["game.js"],"names":["Global","require","cc","Class","extends","Component","properties","startBtn","default","type","Node","puaseBtn","coverBox","player","scoreText","Label","blockBox","blockListPrefab","Prefab","blockPrefab","propPrefab","forcefulPrefab","blastPrefab","initGame","active","onDrag","gameData","over","i","createBlockList","getComponent","shooting","schedule","createProp","startGame","director","resume","pauseGame","pause","offDrag","gameEnd","console","log","setTimeout","loadScene","getScore","pack","score","forceful","string","on","dragMove","off","event","locationv","getLocation","location","node","convertToNodeSpaceAR","minX","width","maxX","minY","height","maxY","x","y","setPosition","parseInt","Math","random","newProp","instantiate","_x","_y","addChild","num","list","parent","listSpacing","blastObjGroup","blastPool","NodePool","blast","ParticleSystem","stopSystem","put","onLoad","game","level","manager","getCollisionManager","enabled","window","wx","getSystemInfoSync","windowWidth","start","showShareMenu","onShareAppMessage","title","shareInfo","imageUrl","url"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\game","sourcesContent":["const Global = require(\"Global\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 开始按钮\r\n        startBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 暂停\r\n        puaseBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 游戏开始遮罩层(这里我设成了一个全屏按钮，这样就不用初始化添加事件柄了)\r\n        coverBox: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 飞机\r\n        player: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 分数label\r\n        scoreText: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        // 方块的容器\r\n        blockBox: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 方块列表资源\r\n        blockListPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 生成的方块资源\r\n        blockPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 道具包资源（散弹）\r\n        propPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 道具包资源（强力弹）\r\n        forcefulPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 生成的粒子资源\r\n        blastPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n    },\r\n\r\n    // Method:\r\n\r\n    initGame() {\r\n        this.coverBox.active = false;\r\n        // 添加触摸事件\r\n        this.onDrag();\r\n        Global.gameData.over = false;\r\n        // 方块列表生成\r\n        for (let i = 0; i < 3; i++) {\r\n            this.createBlockList(i);\r\n        }\r\n        // 开始发射子弹\r\n        this.player.getComponent('player').shooting();\r\n        // 道具定时派出\r\n        this.schedule(() => {\r\n            this.createProp();\r\n        }, 16);\r\n    },\r\n    // 开始游戏\r\n    startGame() {\r\n        cc.director.resume();\r\n        this.puaseBtn.active = true;\r\n        this.startBtn.active = false;\r\n        this.onDrag();\r\n    },\r\n    // 暂停游戏\r\n    pauseGame() {\r\n        if (Global.gameData.over) return;\r\n        cc.director.pause();\r\n        this.startBtn.active = true;\r\n        this.puaseBtn.active = false;\r\n        this.offDrag();\r\n    },\r\n    // 游戏结束\r\n    gameEnd() {\r\n        console.log('游戏结束~');\r\n        cc.director.pause();\r\n        this.offDrag();\r\n        Global.gameData.over = true;\r\n        setTimeout(() => {\r\n            cc.director.loadScene('rank', () => {\r\n                console.log('重置游戏了~');\r\n                cc.director.resume();\r\n            });\r\n        }, 1000);\r\n    },\r\n    // 游戏得分\r\n    getScore() {\r\n        if (Global.gameData.pack == 'forceful') {\r\n            Global.gameData.score += Global.gameData.forceful\r\n        } else { \r\n            Global.gameData.score += 1;\r\n        }\r\n        this.scoreText.string = Global.gameData.score;\r\n    },\r\n    // 添加拖动监听\r\n    onDrag() {\r\n        this.player.on('touchmove', this.dragMove, this);\r\n    },\r\n    // 清除拖动监听\r\n    offDrag() {\r\n        this.player.off('touchmove', this.dragMove, this);\r\n    },\r\n    // 设置飞机拖拽\r\n    dragMove(event) {\r\n        if (Global.gameData.over) return;\r\n        let locationv = event.getLocation();\r\n        let location = this.node.convertToNodeSpaceAR(locationv);\r\n        // 飞机不移出屏幕\r\n        let minX = -this.node.width / 2 + this.player.width / 6,\r\n            maxX = -minX,\r\n            minY = -this.node.height / 2 + this.player.height / 6,\r\n            maxY = -minY;\r\n        if (location.x < minX) location.x = minX;\r\n        if (location.x > maxX) location.x = maxX;\r\n        if (location.y < minY) location.y = minY;\r\n        if (location.y > maxY) location.y = maxY;\r\n        this.player.setPosition(location);\r\n    },\r\n    // 创建道具包\r\n    createProp() {\r\n        let type = parseInt(2 * Math.random()) + 1;\r\n        // 随机派送一个道具\r\n        let newProp = type == 1 ? cc.instantiate(this.propPrefab) : cc.instantiate(this.forcefulPrefab);\r\n        let _x = parseInt((this.blockBox.width - newProp.width) * Math.random()) + 1 + newProp.width,\r\n            _y = this.blockBox.height + newProp.height;\r\n        newProp.setPosition(_x, _y);\r\n        this.blockBox.addChild(newProp);\r\n    },\r\n    // 创建方块列表\r\n    createBlockList(num) {\r\n        let list = cc.instantiate(this.blockListPrefab);\r\n        list.width = this.node.width;\r\n        list.height = 210;\r\n        list.parent = this.blockBox;\r\n        list.setPosition(0, Global.gameData.listSpacing * num + this.node.height)\r\n    },\r\n    // 创建粒子对象池\r\n    blastObjGroup() {\r\n        Global.gameData.blastPool = new cc.NodePool();\r\n        for (let i = 0; i < 20; ++i) {\r\n            let blast = cc.instantiate(this.blastPrefab);\r\n            blast.getComponent(cc.ParticleSystem).stopSystem();\r\n            Global.gameData.blastPool.put(blast);\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        // 储存游戏 & 重置全局数据\r\n        Global.game = this;\r\n        Global.gameData.over = true;\r\n        Global.gameData.score = 0;\r\n        Global.gameData.level = 1;\r\n        Global.gameData.pack = '';\r\n\r\n        // 开启碰撞系统\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        // 开启物理系统(不需要)\r\n        // cc.director.getPhysicsManager().enabled = true;\r\n        // 开启碰撞系统的调试线框绘制\r\n        // manager.enabledDebugDraw = true;\r\n        // manager.enabledDrawBoundingBox = true;\r\n\r\n        this.blastObjGroup();\r\n\r\n        if (window.wx) {\r\n            console.log('宽度：', this.node.width, wx.getSystemInfoSync().windowWidth);\r\n        }\r\n    },\r\n\r\n    start () {\r\n        if (window.wx) {\r\n            // 显示分享按钮\r\n            wx.showShareMenu()\r\n\r\n            // 设置转发分内容\r\n            wx.onShareAppMessage(res => {\r\n                // console.log('监听分享内容', res);\r\n                return {\r\n                    title: Global.shareInfo.title,\r\n                    imageUrl: Global.shareInfo.url,\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}