{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\game/assets\\Script\\game\\game.js"],"names":["Global","require","cc","Class","extends","Component","properties","startBtn","default","type","Node","puaseBtn","coverBox","player","scoreText","Label","blockBox","blockListPrefab","Prefab","blockPrefab","propPrefab","forcefulPrefab","fastPrefab","blastPrefab","initGame","active","onDrag","gameData","over","i","createBlockList","schedule","createProp","startGame","director","resume","pauseGame","pause","offDrag","gameEnd","console","log","setTimeout","loadScene","getScore","pack","score","forceful","string","on","dragMove","off","event","locationv","getLocation","location","node","convertToNodeSpaceAR","minX","width","maxX","minY","height","maxY","x","y","setPosition","parseInt","Math","random","newProp","instantiate","_x","_y","addChild","num","list","parent","listSpacing","blastObjGroup","blastPool","NodePool","blast","getComponent","ParticleSystem","stopSystem","put","onLoad","game","level","bulletNum","saveNum","manager","getCollisionManager","enabled","window","wx","getSystemInfoSync","windowWidth","start","showShareMenu","onShareAppMessage","title","shareInfo","imageUrl","url"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\game","sourcesContent":["const Global = require(\"Global\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 开始按钮\r\n        startBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 暂停\r\n        puaseBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 游戏开始遮罩层(这里我设成了一个全屏按钮，这样就不用初始化添加事件柄了)\r\n        coverBox: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 飞机\r\n        player: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 分数label\r\n        scoreText: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        // 方块的容器\r\n        blockBox: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // 方块列表资源\r\n        blockListPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 生成的方块资源\r\n        blockPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 道具包资源（散弹）\r\n        propPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 道具包资源（强力弹）\r\n        forcefulPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 道具包资源（快速弹）\r\n        fastPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 生成的粒子资源\r\n        blastPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n    },\r\n\r\n    // Method:\r\n\r\n    initGame() {\r\n        this.coverBox.active = false;\r\n        // 添加触摸事件\r\n        this.onDrag();\r\n        Global.gameData.over = false;\r\n        // 方块列表生成\r\n        for (let i = 0; i < 3; i++) {\r\n            this.createBlockList(i);\r\n        }\r\n        // 道具定时派出\r\n        this.schedule(() => {\r\n            this.createProp();\r\n        }, 16);\r\n    },\r\n    // 开始游戏\r\n    startGame() {\r\n        cc.director.resume();\r\n        this.puaseBtn.active = true;\r\n        this.startBtn.active = false;\r\n        this.onDrag();\r\n    },\r\n    // 暂停游戏\r\n    pauseGame() {\r\n        if (Global.gameData.over) return;\r\n        cc.director.pause();\r\n        this.startBtn.active = true;\r\n        this.puaseBtn.active = false;\r\n        this.offDrag();\r\n    },\r\n    // 游戏结束\r\n    gameEnd() {\r\n        console.log('游戏结束~');\r\n        cc.director.pause();\r\n        this.offDrag();\r\n        Global.gameData.over = true;\r\n        setTimeout(() => {\r\n            cc.director.loadScene('rank', () => {\r\n                console.log('重置游戏了~');\r\n                cc.director.resume();\r\n            });\r\n        }, 1000);\r\n    },\r\n    // 游戏得分\r\n    getScore() {\r\n        if (Global.gameData.pack == 'forceful') {\r\n            Global.gameData.score += Global.gameData.forceful\r\n        } else { \r\n            Global.gameData.score += 1;\r\n        }\r\n        this.scoreText.string = Global.gameData.score;\r\n    },\r\n    // 添加拖动监听\r\n    onDrag() {\r\n        this.player.on('touchmove', this.dragMove, this);\r\n    },\r\n    // 清除拖动监听\r\n    offDrag() {\r\n        this.player.off('touchmove', this.dragMove, this);\r\n    },\r\n    // 设置飞机拖拽\r\n    dragMove(event) {\r\n        if (Global.gameData.over) return;\r\n        let locationv = event.getLocation();\r\n        let location = this.node.convertToNodeSpaceAR(locationv);\r\n        // 飞机不移出屏幕\r\n        let minX = -this.node.width / 2 + this.player.width / 2,\r\n            maxX = -minX,\r\n            minY = -this.node.height / 2 + this.player.height / 2,\r\n            maxY = -minY;\r\n        if (location.x < minX) location.x = minX;\r\n        if (location.x > maxX) location.x = maxX;\r\n        if (location.y < minY) location.y = minY;\r\n        if (location.y > maxY) location.y = maxY;\r\n        this.player.setPosition(location);\r\n    },\r\n    // 创建道具包\r\n    createProp() {\r\n        let type = parseInt(3 * Math.random()) + 1;\r\n        // 随机派送一个道具\r\n        let newProp = null;\r\n        switch (type) {\r\n            case 1:\r\n                newProp = cc.instantiate(this.propPrefab);\r\n                break;\r\n            case 2:\r\n                newProp = cc.instantiate(this.forcefulPrefab);\r\n                break;\r\n            case 3:\r\n                newProp = cc.instantiate(this.fastPrefab);\r\n                break;\r\n        }\r\n        let _x = parseInt((this.blockBox.width - newProp.width * 2) * Math.random()) + 1 + newProp.width,\r\n            _y = this.blockBox.height + newProp.height;\r\n        newProp.setPosition(_x, _y);\r\n        this.blockBox.addChild(newProp);\r\n        cc.log('随机的道具类型：', type)\r\n    },\r\n    // 创建方块列表\r\n    createBlockList(num) {\r\n        let list = cc.instantiate(this.blockListPrefab);\r\n        list.width = this.node.width;\r\n        list.height = 210;\r\n        list.parent = this.blockBox;\r\n        list.setPosition(0, Global.gameData.listSpacing * num + this.node.height)\r\n    },\r\n    // 创建粒子对象池\r\n    blastObjGroup() {\r\n        Global.gameData.blastPool = new cc.NodePool();\r\n        for (let i = 0; i < 20; ++i) {\r\n            let blast = cc.instantiate(this.blastPrefab);\r\n            blast.getComponent(cc.ParticleSystem).stopSystem();\r\n            Global.gameData.blastPool.put(blast);\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        // 储存游戏 & 重置全局数据\r\n        Global.game = this;\r\n        Global.gameData.over = true;\r\n        Global.gameData.score = 0;\r\n        Global.gameData.level = 1;\r\n        Global.gameData.pack = '';\r\n        Global.gameData.bulletNum = Global.gameData.saveNum;\r\n        \r\n        // 开启碰撞系统\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        // 开启物理系统(不需要)\r\n        // cc.director.getPhysicsManager().enabled = true;\r\n        // 开启碰撞系统的调试线框绘制\r\n        // manager.enabledDebugDraw = true;\r\n        // manager.enabledDrawBoundingBox = true;\r\n\r\n        this.blastObjGroup();\r\n\r\n        if (window.wx) {\r\n            console.log('宽度：', this.node.width, wx.getSystemInfoSync().windowWidth);\r\n        }\r\n    },\r\n\r\n    start () {\r\n        if (window.wx) {\r\n            // 显示分享按钮\r\n            wx.showShareMenu()\r\n\r\n            // 设置转发分内容\r\n            wx.onShareAppMessage(res => {\r\n                // console.log('监听分享内容', res);\r\n                return {\r\n                    title: Global.shareInfo.title,\r\n                    imageUrl: Global.shareInfo.url,\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}